<!--
  Generated template for the MainSearchPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>

  <ion-navbar color="foursquare">
    <ion-title *ngIf="city_to_search">{{ city_to_search.name }}</ion-title>
    <ion-buttons right>
      <button class="top_icons" ion-button icon-only (click)="presentPopover($event)">
        <ion-icon name="more">
        </ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>

  <ion-toolbar>
    <ion-segment [(ngModel)]="select_day" color="foursquare">
      <ion-segment-button id="select_button{{current_day_less}}" value="{{current_day_less}}" (click)="oneDayLess()">
        Día {{ current_day_less }}
      </ion-segment-button>
      <ion-segment-button id="select_button{{current_day}}" value="{{current_day}}" *ngIf="route.numDays >= 2" (click)="removeActive()">
        Día {{ current_day }}
      </ion-segment-button>
      <ion-segment-button id="select_button{{current_day_plus}}" value="{{current_day_plus}}" *ngIf="route.numDays >= 3" (click)="oneMoreDay()">
        Día {{ current_day_plus }}
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content class="main_content">



  <div [ngSwitch]="select_day">

    <!-- DIV DIAS DEL MEDIO -->
    <div *ngSwitchCase=current_day>
      <ion-list *ngIf="route.days[current_day-1].places" [reorder]="editing" (ionItemReorder)="reorderItems(current_day, $event)">
        <div *ngFor="let place of route.days[current_day-1].places; let i = index;">    
          <ion-item id="placeitem" color="foursquare_light">
            <ion-thumbnail id="placethumbnail" item-end>
              <img *ngIf="place.place.photo!='none' && place.place.photo!=undefined" class="imgicon" src="{{place.place.photo}}">
              <img *ngIf="place.place.photo=='none' || place.place.photo==undefined" style="background-color: rgba(231, 108, 108, 0.65);" class="imgicon" src="{{place.place.categoryIcon}}">   
              </ion-thumbnail>
            <h2 class="placetitulo">{{place.place.name}}</h2>

            <div *ngIf="i==0" >
              <div class="placehour1">
                <ion-icon class="icono_col" name="log-in"></ion-icon>
                {{convertMsToDate(route.days[current_day-1].startTime)}}
              </div>
            </div>

            <div *ngIf="i!=0">
              <div  class="placehour1">
                <ion-icon class="icono_col" name="log-in"></ion-icon>
                {{ getArrivalTime(route.days[current_day-1].startTime, route.days[current_day-1].places, i) }}
              </div>
            </div>

            <div class="placehour2" (click)="picker.open()">
                <ion-icon id="houricon1" name="log-out"></ion-icon>
                {{ getDepartureTime(route.days[current_day-1].startTime, route.days[current_day-1].places, i, place.time) }} ({{ convertMsToString(place.time) }})
                <ion-icon id="houricon2" name="settings"></ion-icon>
              </div>

          </ion-item>
          <ion-datetime style="display: none" #picker pickerFormat="HH mm" hourValues="0,1,2,3,4,5,6" minuteValues="0,5,10,15,20,25,30,35,40,45,50,55"
            [(ngModel)]="selectedTime" (ngModelChange)="setPlaceTime(current_day, i, selectedTime)"></ion-datetime>


            <ion-grid *ngIf="i < route.days[current_day-1].places.length-1">
              <ion-row id="fila">
                <ion-col id="col1">
                  {{ convertMsToStringLarge(place.travelTime) }}
                </ion-col>
                <ion-col col-2  id="col2" (click)="changeTravelMode(place.travelMode, current_day-1, i)">
                  <img *ngIf="place.travelMode=='WALKING'" style="vertical-align:middle" id="travel_img" src="../assets/img/travel_walk.jpg" alt="no_img">
                  <img *ngIf="place.travelMode=='DRIVING'" style="vertical-align:middle" id="travel_img" src="../assets/img/travel_car.png" alt="no_img">
                  <img *ngIf="place.travelMode=='BICYCLING'" style="vertical-align:middle" id="travel_img" src="../assets/img/travel_bike.png" alt="no_img">
                </ion-col>
                <ion-col  id="col3">
                  3.4 km
                </ion-col>
              </ion-row>
            </ion-grid>
          </div>
        
      </ion-list>
      <div id="div_add_bottom">
        <button id="button_add_bottom" ion-button icon-left color="light" (click)="showActionsAdd()">
          <ion-icon name="add"></ion-icon>
          Añadir Sitio
        </button>
      </div>
    </div>

    <!-- DIV PRIMER DIA -->
    <div *ngSwitchCase=current_day_less>
      <ion-list *ngIf="route.days[current_day_less-1].places" [reorder]="editing" (ionItemReorder)="reorderItems(current_day_less, $event)">
        <div *ngFor="let place of route.days[current_day_less-1].places; let i = index;">    
          <ion-item id="placeitem" color="foursquare_light">
            <ion-thumbnail id="placethumbnail" item-end>
              <img *ngIf="place.place.photo!='none' && place.place.photo!=undefined" class="imgicon" src="{{place.place.photo}}">
              <img *ngIf="place.place.photo=='none' || place.place.photo==undefined" style="background-color: rgba(231, 108, 108, 0.65);" class="imgicon" src="{{place.place.categoryIcon}}">   
              </ion-thumbnail>
            <h2 class="placetitulo">{{place.place.name}}</h2>

            <div *ngIf="i==0" >
              <div class="placehour1">
                <ion-icon class="icono_col" name="log-in"></ion-icon>
                {{convertMsToDate(route.days[current_day_less-1].startTime)}}
              </div>
            </div>

            <div *ngIf="i!=0">
              <div  class="placehour1">
                <ion-icon class="icono_col" name="log-in"></ion-icon>
                {{ getArrivalTime(route.days[current_day_less-1].startTime, route.days[current_day_less-1].places, i) }}
              </div>
            </div>

            <div class="placehour2" (click)="picker.open()">
                <ion-icon id="houricon1" name="log-out"></ion-icon>
                {{ getDepartureTime(route.days[current_day_less-1].startTime, route.days[current_day_less-1].places, i, place.time) }} ({{ convertMsToString(place.time) }})
                <ion-icon id="houricon2" name="settings"></ion-icon>
              </div>

          </ion-item>
          <ion-datetime style="display: none" #picker pickerFormat="HH mm" hourValues="0,1,2,3,4,5,6" minuteValues="0,5,10,15,20,25,30,35,40,45,50,55"
            [(ngModel)]="selectedTime" (ngModelChange)="setPlaceTime(current_day_less, i, selectedTime)"></ion-datetime>


            <ion-grid *ngIf="i < route.days[current_day_less-1].places.length-1">
              <ion-row id="fila">
                <ion-col id="col1">
                  {{ convertMsToStringLarge(place.travelTime) }}
                </ion-col>
                <ion-col col-2  id="col2" (click)="changeTravelMode(place.travelMode, current_day_less-1, i)">
                  <img *ngIf="place.travelMode=='WALKING'" style="vertical-align:middle" id="travel_img" src="../assets/img/travel_walk.jpg" alt="no_img">
                  <img *ngIf="place.travelMode=='DRIVING'" style="vertical-align:middle" id="travel_img" src="../assets/img/travel_car.png" alt="no_img">
                  <img *ngIf="place.travelMode=='BICYCLING'" style="vertical-align:middle" id="travel_img" src="../assets/img/travel_bike.png" alt="no_img">
                </ion-col>
                <ion-col  id="col3">
                  3.4 km
                </ion-col>
              </ion-row>
            </ion-grid>
          </div>
        
      </ion-list>
      <div id="div_add_bottom">
        <button id="button_add_bottom" ion-button icon-left color="light" (click)="showActionsAdd()">
          <ion-icon name="add"></ion-icon>
          Añadir Sitio
        </button>
      </div>
    </div>

    <!-- DIV ULTIMO DIA -->
    <div *ngSwitchCase=current_day_plus>
      <ion-list *ngIf="route.days[current_day_plus-1].places" [reorder]="editing" (ionItemReorder)="reorderItems(current_day_plus, $event)">
        <div *ngFor="let place of route.days[current_day_plus-1].places; let i = index;">    
          <ion-item id="placeitem" color="foursquare_light">
            <ion-thumbnail id="placethumbnail" item-end>
              <img *ngIf="place.place.photo!='none' && place.place.photo!=undefined" class="imgicon" src="{{place.place.photo}}">
              <img *ngIf="place.place.photo=='none' || place.place.photo==undefined" style="background-color: rgba(231, 108, 108, 0.65);" class="imgicon" src="{{place.place.categoryIcon}}">   
              </ion-thumbnail>
            <h2 class="placetitulo">{{place.place.name}}</h2>

            <div *ngIf="i==0" >
              <div class="placehour1">
                <ion-icon class="icono_col" name="log-in"></ion-icon>
                {{convertMsToDate(route.days[current_day_plus-1].startTime)}}
              </div>
            </div>

            <div *ngIf="i!=0">
              <div  class="placehour1">
                <ion-icon class="icono_col" name="log-in"></ion-icon>
                {{ getArrivalTime(route.days[current_day_plus-1].startTime, route.days[current_day_plus-1].places, i) }}
              </div>
            </div>

            <div class="placehour2" (click)="picker.open()">
                <ion-icon id="houricon1" name="log-out"></ion-icon>
                {{ getDepartureTime(route.days[current_day_plus-1].startTime, route.days[current_day_plus-1].places, i, place.time) }} ({{ convertMsToString(place.time) }})
                <ion-icon id="houricon2" name="settings"></ion-icon>
              </div>

          </ion-item>
          <ion-datetime style="display: none" #picker pickerFormat="HH mm" hourValues="0,1,2,3,4,5,6" minuteValues="0,5,10,15,20,25,30,35,40,45,50,55"
            [(ngModel)]="selectedTime" (ngModelChange)="setPlaceTime(current_day_plus, i, selectedTime)"></ion-datetime>


            <ion-grid *ngIf="i < route.days[current_day_plus-1].places.length-1">
              <ion-row id="fila">
                <ion-col id="col1">
                  {{ convertMsToStringLarge(place.travelTime) }}
                </ion-col>
                <ion-col col-2  id="col2" (click)="changeTravelMode(place.travelMode, current_day_plus-1, i)">
                  <img *ngIf="place.travelMode=='WALKING'" style="vertical-align:middle" id="travel_img" src="../assets/img/travel_walk.jpg" alt="no_img">
                  <img *ngIf="place.travelMode=='DRIVING'" style="vertical-align:middle" id="travel_img" src="../assets/img/travel_car.png" alt="no_img">
                  <img *ngIf="place.travelMode=='BICYCLING'" style="vertical-align:middle" id="travel_img" src="../assets/img/travel_bike.png" alt="no_img">
                </ion-col>
                <ion-col  id="col3">
                  3.4 km
                </ion-col>
              </ion-row>
            </ion-grid>
          </div>
        
      </ion-list>
      <div id="div_add_bottom">
        <button id="button_add_bottom" ion-button icon-left color="light" (click)="showActionsAdd()">
          <ion-icon name="add"></ion-icon>
          Añadir Sitio
        </button>
      </div>
    </div>
  </div>



</ion-content>