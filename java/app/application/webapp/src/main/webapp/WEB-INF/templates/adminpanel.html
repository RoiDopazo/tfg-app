<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
>
<head>
<title>Spring Security Example</title>
<link rel="stylesheet" th:href="@{/resources/css/adminpanel.css}" />
<div th:replace="fragments/header :: header-css" />
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"
></script>

</head>
<body class="container">

	<div th:replace="fragments/header :: header" />



	<section>

		<button id="bt1">Load Fragment 1</button>
		<button id="bt2">Load Fragment 2</button>

		<ol id="lista3">
			<li id="userListSelect" class="itemList">Usuarios</li>
			<div class="loader" id="userLoader"></div>
			<div id="userContent"></div>
			<li id="routeListSelect" class="itemList">Rutas</li>
			<div class="loader" id="routeLoader"></div>
			<div id="routeContent"></div>
			<li class="itemList">Lugares (FS)</li>
			<li class="itemList">Eventos</li>
			<li class="itemList">Categorias (FS)</li>
			<li class="itemList">SubCategorias (FS)</li>
		</ol>
	</section>





	<dialog id="asdasd" class="site-dialog"> <header
		class="dialog-header"
	>
		<h1>Please Confirm</h1>
	</header>
	<div class="dialog-content">
		<p>You are about to close your account. This action is
			irreversible. It will permanently delete your account along with its
			associated data. Are you sure you want to continue?</p>
	</div>
	<div class="btn-group cf">
		<button class="btn btn-danger" id="delete">Delete</button>
		<button class="btn btn-cancel" id="cancel">Cancel</button>

	</div>
	</dialog>



	<div th:replace="fragments/footer :: footer" />

	<script>
		/*<![CDATA[*/

		$("#userListSelect").on("click", function() {

			$("#userLoader").show();
			$("#userContent").load("/admin/panel/ajax/user", function() {
				$("#userLoader").hide();
			});

		});

		$("#routeListSelect").on("click", function() {
			$("#routeLoader").show();
			$("#routeContent").hide();
			$("#routeContent").load("/admin/panel/ajax/route?index=0", function() {
				$("#routeLoader").hide();
				$("#routeContent").show();
			});
		});

		function openModalDelete(id, entity) {
			console.log(id);
			console.log(entity);
			bootbox.confirm("Are you sure want to delete?", function(result) {
				if (result) {
					$.ajax({
						type : "DELETE",
						url : "/admin/panel/ajax/" + entity + "/" + id,
						contentType : "application/json",
						success : function(result) {
							resetFilter(entity);
							console.log("result");
							alert("YES");
						},
						error : function(error) {
							console.log(error);
							alert("NO");
						}
					});
				} else {

				}
			});
		};

		function filterBy(entity) {
			var fieldHtmlId = "#" + entity + "-select-filter";
			var valueHtmlId = "#" + entity + "-input-filter";
			var contentHtmlId = "#" + entity + "Content";
			var field = $(fieldHtmlId).val();
			var value = $(valueHtmlId).val();
			var content = $(contentHtmlId);
			
			console.log(field);
			console.log(value);
			console.log(content);
			
			$("#routeLoader").show();
			$("#routeContent").hide();
			content.load("/admin/panel/ajax/" + entity + "?filterBy=" + field + "&value=" + value, function() {
				$("#routeLoader").hide();
				$("#routeContent").show();
			});
		};

		function resetFilter(entity) {
			var string = "#" + entity + "ListSelect";
			var valueHtmlId = "#" + entity + "-input-filter";
			var value = $(valueHtmlId).value = "";
			$(string).click();
		};
		
		
		var openModalEdit = function(id, entity) {
			$.ajax({
				type: "GET",
				url: "/admin/panel/ajax/object/" + entity + "/" + id,
				contentType : "application/json",
				success : function(object) {	
					
					var keys = Object.keys(object);
					for (variable in keys) {
						var text = "#input-up-" + entity + "-" + keys[variable];
						if ($(text).is("input")) {
							$(text).attr('value', object[keys[variable]]);
						}
						if ($(text).is("select")) {
							$(text + " option[value='" + object[keys[variable]] + "']").attr('selected' , true);
						}
					}
					
					var bootboxText = "#" + entity + "-edit-div";
					var bootboxForm = entity + "-edit-form";
					var bootboxHtml = $(bootboxText).html().replace(
							bootboxForm, 'js-bootboxForm');			
					bootbox.confirm(bootboxHtml, function(result) {
						if (result) {
							for (variable in keys) {
								var text = "#input-up-" + entity + "-" + keys[variable];
								object[keys[variable]] = $(text, '.js-bootboxForm').val();			
							}
							// hacer peti update
							$.ajax({
								type: "PUT",
								url: "/admin/panel/ajax/" + entity + "/" + id,
								contentType : "application/json",
								data: JSON.stringify(object),
								success: function (done) {
									resetFilter(entity);
									bootbox.alert({
									    message: "La entidad ha sido modificada correctamente",
									    backdrop: true
									});
								},
								error: function (err) {
									bootbox.alert({
									    message: "Se ha producido un error al updatear la entidad indicada"
									});
								}
							});
						}		
					});
				}
			});
			
		};

		/*]]>*/
	</script>
</body>
</html>